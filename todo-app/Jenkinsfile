pipeline {
    agent any

    tools {
        nodejs "NodeJS"
    }


    environment {
        CI = 'false'
        HOME = '.'
        npm_config_cache = 'npm-cache'
        bucket = "todo-app-js"
        region = "us-east-2"
    }
    stages {
        stage('Build') {
            steps {
                dir('todo-app') {
                    sh 'npm install'
                    sh 'npm run build'
                }
            }
        }
        stage('Production') {
            steps {
                withAWS(region:'${region}',credentials:'${AWS_CREDENTIAL_ID}') {
                    s3Delete(bucket: '${bucket}', path:'**/*')
                    s3Upload(bucket: '${bucket}', workingDir:'build', includePathPattern:'**/*');
                }
            }
        }
    }
}